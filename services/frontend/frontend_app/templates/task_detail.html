{% extends "base.html" %}

{% block title %}{{ task.title }} - Task Manager{% endblock %}

{% block content %}
<div class="container">
    <article class="task-detail" data-testid="task-detail">
        <header class="task-detail-header">
            <h1 data-testid="task-title">{{ task.title }}</h1>
            <div class="task-badges">
                <span class="status-badge status-{{ task.status }}" data-testid="task-status">
                    {{ task.status | replace('_', ' ') | title }}
                </span>
                <span class="priority-badge priority-badge-{{ task.priority }}" data-testid="task-priority">
                    {{ task.priority | title }} Priority
                </span>
            </div>
        </header>

        <section class="task-detail-body">
            {% if task.description %}
                <div class="task-description" data-testid="task-description">
                    <h2>Description</h2>
                    <p>{{ task.description }}</p>
                </div>
            {% else %}
                <p class="no-description" data-testid="no-description">No description provided.</p>
            {% endif %}

            <div class="task-metadata" data-testid="task-metadata">
                <dl>
                    {% if task.due_date %}
                        <dt>Due Date</dt>
                        <dd data-testid="task-due-date">
                            {{ task.due_date.strftime('%B %d, %Y at %H:%M') }}
                        </dd>
                    {% endif %}

                    <dt>Created</dt>
                    <dd data-testid="task-created">
                        {{ task.created_at.strftime('%B %d, %Y at %H:%M') }}
                    </dd>

                    <dt>Last Updated</dt>
                    <dd data-testid="task-updated">
                        {{ task.updated_at.strftime('%B %d, %Y at %H:%M') }}
                    </dd>
                </dl>
            </div>
        </section>

        <footer class="task-detail-actions">
            <!-- Quick Status Update -->
            <form method="POST"
                  action="{{ url_for('views.update_status', task_id=task.id) }}"
                  class="inline-form"
                  data-testid="status-update-form">
                <label for="quick-status">Change Status:</label>
                <select name="status" id="quick-status" data-testid="status-select">
                    {% for status in statuses %}
                        <option value="{{ status.value }}"
                                {% if task.status == status.value %}selected{% endif %}>
                            {{ status.value | replace('_', ' ') | title }}
                        </option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-small" data-testid="update-status-btn">
                    Update
                </button>
            </form>

            <div class="action-buttons">
                <a href="{{ url_for('views.edit_task', task_id=task.id) }}"
                   class="btn btn-primary"
                   data-testid="edit-button">
                    Edit Task
                </a>

                <form method="POST"
                      action="{{ url_for('views.delete_task', task_id=task.id) }}"
                      class="inline-form"
                      data-testid="delete-form"
                      onsubmit="return confirm('Are you sure you want to delete this task?');">
                    <button type="submit" class="btn btn-danger" data-testid="delete-button">
                        Delete Task
                    </button>
                </form>

                <a href="{{ url_for('views.index') }}" class="btn btn-secondary" data-testid="back-button">
                    Back to List
                </a>
            </div>
        </footer>
    </article>
</div>
{% endblock %}
